<div class="page-container">

  <div class="page-header">
    <h2>GRÁFICAS DE MARCACIONES QR</h2>
    </div>

  <form [formGroup]="filterForm" class="report-filter-container">

    <mat-form-field appearance="outline">
      <mat-label>Cliente</mat-label>
      <mat-select formControlName="clienteId">
        <mat-option [value]="null">-- Todos los clientes --</mat-option>
        <mat-option *ngFor="let cliente of clientes" [value]="cliente.id">
          {{ cliente.nombre }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Sede</mat-label>
      <mat-select formControlName="sedeId">
         <mat-option [value]="null">-- Todas las sedes --</mat-option>
        <mat-option *ngFor="let sede of filteredSedes" [value]="sede.id">
          {{ sede.sede }}
        </mat-option>
      </mat-select>
      <mat-hint *ngIf="filterForm.get('sedeId')?.disabled">Seleccione un cliente primero</mat-hint>
    </mat-form-field>

    <button mat-flat-button color="primary" (click)="downloadChart()" [disabled]="!chartData.datasets.length || isLoading">
      <mat-icon>download</mat-icon>
      DESCARGAR GRÁFICO
    </button>
  </form>

  <div class="chart-container">

    <div *ngIf="isLoading" class="loading-indicator">
      <mat-spinner diameter="40" style="margin-right: 10px;"></mat-spinner>
      Cargando datos...
    </div>

    <div *ngIf="!isLoading && (!chartData.labels || chartData.labels.length === 0)" class="no-data-message">
       <p>Seleccione un cliente para generar el reporte visual.<br>No hay datos disponibles con los filtros actuales.</p>
    </div>

    <canvas *ngIf="!isLoading && chartData.labels && chartData.labels.length > 0"
            baseChart
            [data]="chartData"
            [options]="chartOptions"
            [type]="chartType">
    </canvas>
  </div>

</div>
